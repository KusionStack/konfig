- id: aliyun:alicloud:alicloud_vpc:wordpress-deployment-vpc
  type: Terraform
  attributes:
    cidr_block: 172.16.0.0/16
    vpc_name: wordpress-deployment-vpc
  extensions:
    provider: registry.terraform.io/aliyun/alicloud/1.201.1
    providerMeta:
        region: cn-beijing
    resourceType: alicloud_vpc
- id: aliyun:alicloud:alicloud_vswitch:wordpress-deployment-vswitch
  type: Terraform
  attributes:
    cidr_block: 172.16.0.0/24
    vpc_id: $kusion_path.aliyun:alicloud:alicloud_vpc:wordpress-deployment-vpc.id
    vswitch_name: wordpress-deployment-vswitch
    zone_id: cn-beijing-h
  extensions:
    provider: registry.terraform.io/aliyun/alicloud/1.201.1
    providerMeta:
        region: cn-beijing
    resourceType: alicloud_vswitch
- id: aliyun:alicloud:alicloud_db_instance:wordpress-deployment-db
  type: Terraform
  attributes:
    category: serverless_basic
    db_instance_storage_type: cloud_essd
    engine: MySQL
    engine_version: "5.7"
    instance_charge_type: Serverless
    instance_name: wordpress-deployment-db
    instance_storage: 20
    instance_type: mysql.n2.serverless.1c
    security_ips:
        - 0.0.0.0/0
    serverless_config:
        - auto_pause: false
          max_capacity: 8
          min_capacity: 0.5
          switch_force: false
    vswitch_id: $kusion_path.aliyun:alicloud:alicloud_vswitch:wordpress-deployment-vswitch.id
  extensions:
    provider: registry.terraform.io/aliyun/alicloud/1.201.1
    providerMeta:
        region: cn-beijing
    resourceType: alicloud_db_instance
- id: aliyun:alicloud:alicloud_db_connection:wordpress-deployment-connection
  type: Terraform
  attributes:
    connection_prefix: wordpress-deployment-connection
    instance_id: $kusion_path.aliyun:alicloud:alicloud_db_instance:wordpress-deployment-db.id
  extensions:
    provider: registry.terraform.io/aliyun/alicloud/1.201.1
    providerMeta:
        region: cn-beijing
    resourceType: alicloud_db_connection
- id: aliyun:alicloud:alicloud_rds_account:root
  type: Terraform
  attributes:
    account_name: root
    account_password: Kusion123456
    account_type: Super
    db_instance_id: $kusion_path.aliyun:alicloud:alicloud_db_instance:wordpress-deployment-db.id
  dependsOn:
    - aliyun:alicloud:alicloud_db_connection:wordpress-deployment-connection
  extensions:
    provider: registry.terraform.io/aliyun/alicloud/1.201.1
    providerMeta:
        region: cn-beijing
    resourceType: alicloud_rds_account
- id: core.oam.dev/v1beta1:Application:dev:wordpress-example
  type: Kubernetes
  attributes:
    apiVersion: core.oam.dev/v1beta1
    kind: Application
    metadata:
        name: wordpress-example
        namespace: dev
    spec:
        components:
            - name: wordpress-example-namespace
              properties:
                objects:
                    - apiVersion: v1
                      kind: Namespace
                      metadata:
                        name: wordpress-example
              type: k8s-objects
            - name: wordpress-example-secret
              properties:
                objects:
                    - apiVersion: v1
                      data:
                        password: S3VzaW9uMTIzNDU2
                      kind: Secret
                      metadata:
                        name: mysql-pass
                        namespace: wordpress-example
                      type: Opaque
              type: k8s-objects
            - name: wordpress-example-service
              properties:
                objects:
                    - apiVersion: v1
                      kind: Service
                      metadata:
                        name: wordpress
                        namespace: wordpress-example
                      spec:
                        ports:
                            - port: 80
                        selector:
                            app: wordpress-mysql
                            tier: frontend
                        type: ClusterIP
              type: k8s-objects
            - name: wordpress-example-deployment
              properties:
                objects:
                    - apiVersion: apps/v1
                      kind: Deployment
                      metadata:
                        name: wordpress-deployment
                        namespace: wordpress-example
                      spec:
                        replicas: 1
                        selector:
                            matchLabels:
                                app: wordpress-mysql
                                app.kubernetes.io/component: wordpress-deployment
                                app.kubernetes.io/env: dev
                                app.kubernetes.io/instance: wordpress-example-dev
                                app.kubernetes.io/name: wordpress-example
                                cluster.x-k8s.io/cluster-name: default
                                tier: frontend
                        template:
                            metadata:
                                labels:
                                    app: wordpress-mysql
                                    app.kubernetes.io/component: wordpress-deployment
                                    app.kubernetes.io/env: dev
                                    app.kubernetes.io/instance: wordpress-example-dev
                                    app.kubernetes.io/name: wordpress-example
                                    cluster.x-k8s.io/cluster-name: default
                                    tier: frontend
                            spec:
                                containers:
                                    - env:
                                        - name: WORDPRESS_DB_HOST
                                          value: $kusion_path.aliyun:alicloud:alicloud_db_connection:wordpress-deployment-connection.connection_string
                                        - name: WORDPRESS_DB_PASSWORD
                                          valueFrom:
                                            secretKeyRef:
                                                key: password
                                                name: mysql-pass
                                        - name: ENV_ADD_EXAMPLE
                                          value: wordpress-example
                                      image: wordpress:4.8-apache
                                      name: wordpress
                                      ports:
                                        - containerPort: 80
                                          name: wordpress
                                          protocol: TCP
                                      volumeMounts:
                                        - mountPath: /var/www/html
                                          name: wordpress-persistent-storage
                                volumes:
                                    - emptyDir: {}
                                      name: wordpress-persistent-storage
              type: k8s-objects
        policies:
            - name: default
              properties:
                clusters:
                    - default
                namespace: dev
              type: apply-once
